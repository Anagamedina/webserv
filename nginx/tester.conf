worker_processes 1;
pid /home/carles/Documents/42bcn/webserv/nginx/nginx.pid;

events {
    worker_connections 1024;
}

http {
    include       /home/carles/Documents/42bcn/webserv/nginx/conf/mime.types;
    default_type  application/octet-stream;

    # Log format básico
    access_log /home/carles/Documents/42bcn/webserv/nginx/access.log;
    error_log /home/carles/Documents/42bcn/webserv/nginx/error.log;

    # IMPORTANTE: Nginx necesita un directorio temporal para el body
    client_body_temp_path /home/carles/Documents/42bcn/webserv/nginx/temp;
    fastcgi_temp_path /home/carles/Documents/42bcn/webserv/nginx/temp;
    uwsgi_temp_path /home/carles/Documents/42bcn/webserv/nginx/temp;
    scgi_temp_path /home/carles/Documents/42bcn/webserv/nginx/temp;

    server {
        listen 8080;
        server_name localhost;

        # ------------------------------------------------------------
        # 1. "/" → GET only (en nginx usamos error_page para rechazar otros métodos)
        # ------------------------------------------------------------
        location / {
            root /home/carles/Documents/42bcn/webserv/www/YoupiBanane;
            index index.html;
        # Bloquear explícitamente HEAD
            if ($request_method = HEAD) {
                return 405;
            }
        }

        # ------------------------------------------------------------
        # 2. "/cgi-bin" → POST only
        # ------------------------------------------------------------
        location /cgi-bin {
            root /home/carles/Documents/42bcn/webserv/www/YoupiBanane;
            
            # Solo permitir POST
            if ($request_method != POST) {
                return 405;
            }
            
            # Configuración CGI - requiere fcgiwrap o similar
            # Nota: Nginx no soporta CGI nativamente, necesitas FastCGI
            # Ejemplo con php-fcgi o similar:
            # fastcgi_pass unix:/var/run/fcgiwrap.socket;
            # fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
            
            # Para ejecutar .bla necesitarás un wrapper específico
            location ~ \.bla$ {
                # Configuración específica para .bla
                # fastcgi_pass ... (requiere configuración adicional)
            }
        }

        # ------------------------------------------------------------
        # 3. "/post_body" → POST only, max body 100 bytes
        # ------------------------------------------------------------
        location /post_body {
            # Solo POST
            if ($request_method != POST) {
                return 405;
            }

            # Límite de body (100 bytes)
            client_max_body_size 100;

            # Retornar 200 OK
            return 200 "OK";
        }

        # ------------------------------------------------------------
        # 4. "/directory/" → GET only
        #    root = YoupiBanane
        #    default file = youpi.bad_extension
        # ------------------------------------------------------------
        location /directory/ {
            root /home/carles/Documents/42bcn/webserv/www/YoupiBanane;
            index youpi.bad_extension;

            # Solo GET/HEAD
            if ($request_method !~ ^(GET|HEAD)$) {
                return 405;
            }

            # Autoindex desactivado (comportamiento por defecto)
            autoindex off;
        }
    }
}
